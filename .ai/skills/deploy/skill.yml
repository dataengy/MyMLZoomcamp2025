name: deploy
command: /deploy
version: "1.0"
category: Phase2-MLOps
description: >
  Model deployment assistant. Packages model + deps, updates Docker/API config,
  generates deployment checklists, and runs smoke tests.

triggers:
  - "Deploy model to staging"
  - "Create deployment package"
  - "Update API with new model"
  - "Deploy <model_name>"

inputs:
  - name: model_name
    type: string
    required: true
    description: "Model to deploy (must exist in registry)"
  - name: version
    type: string
    required: false
    default: "latest"
    description: "Model version to deploy. 'latest' = most recent registered"
  - name: target
    type: string
    required: true
    description: "Deployment target: staging | prod | local"
  - name: dry_run
    type: boolean
    required: false
    default: true
    description: "If true, generate plan only without executing"

outputs:
  - path: "deploy/packages/{model_name}_v{N}.tar.gz"
    description: "Self-contained deployment package"
  - path: "deploy/checklists/checklist_{model_name}_{target}_{date}.md"
    description: "Deployment checklist with sign-off items"
  - path: "deploy/docker/Dockerfile.{model_name}"
    description: "Model serving Dockerfile"

dependencies:
  - docker
  - fastapi  # for API endpoint generation
  - uvicorn
  - joblib

workflow:
  1. Resolve model version from registry
  2. Collect dependencies (requirements from experiment)
  3. Generate Dockerfile + docker-compose snippet
  4. Generate deployment checklist (pre/post deploy checks)
  5. If NOT dry_run:
     a. Build Docker image
     b. Run smoke tests (health check + sample prediction)
     c. Tag and push to registry (if prod)
  6. Output package + checklist
