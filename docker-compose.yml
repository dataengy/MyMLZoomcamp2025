services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - .env
    ports:
      - "${PORT:-8000}:8000"
    command: ["uv", "run", "uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8000", "--app-dir", "/app/src"]
  dagster:
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - .env
    environment:
      - DAGSTER_HOME=/app/.dagster
    ports:
      - "${DAGSTER_PORT:-3000}:3000"
    command: ["uv", "run", "dg", "dev", "-m", "dags", "--host", "0.0.0.0", "--port", "3000"]
